<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Retrieval Augmented Generation (RAG) Enhanced Workflow Automations | Querystar | Build Trigger-Action Based Workflows in a Few Lines of Python</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://querystar.io/og.png"><meta data-rh="true" name="twitter:image" content="https://querystar.io/og.png"><meta data-rh="true" property="og:url" content="https://querystar.io/rag/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="workflow, automation, python, trigger, action, saas, tools, api, unified-api, integration, llm, llama-index, langchain, slack, google, gdrive, sheets, knowledge, base"><meta data-rh="true" property="og:title" content="Retrieval Augmented Generation (RAG) Enhanced Workflow Automations | Querystar | Build Trigger-Action Based Workflows in a Few Lines of Python"><meta data-rh="true" name="description" content="Retrieval Augmented Generation (RAG) Enhanced Workflow Automations"><meta data-rh="true" property="og:description" content="Retrieval Augmented Generation (RAG) Enhanced Workflow Automations"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://querystar.io/rag/"><link data-rh="true" rel="alternate" href="https://querystar.io/rag/" hreflang="en"><link data-rh="true" rel="alternate" href="https://querystar.io/rag/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E66JDLT2VX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E66JDLT2VX",{})</script><link rel="stylesheet" href="/assets/css/styles.4279812d.css">
<link rel="preload" href="/assets/js/runtime~main.862ca776.js" as="script">
<link rel="preload" href="/assets/js/main.5fa594ec.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.png" alt="QueryStar Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/logo.png" alt="QueryStar Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">QueryStar</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/pricing">Pricing</a><a class="navbar__item navbar__link" href="/docs/introduction/">Documentation</a><a href="https://github.com/modelstar-labs/querystar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://app.querystar.io/signin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link button button--primary button--outline button--md margin-horiz--md">Sign in</a><a href="https://app.querystar.io/signup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link button button--primary button--md margin-horiz--sm">Sign up</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><h1>Retrieval Augmented Generation (RAG) Enhanced Workflow Automations</h1><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwUlEQVQImT3Mv2rCQADH8XsBnQSXTqWLU6CDQwf7AAqd3Do5FYoP4NqhfYSOboq4dmifpJxSpPlDEqeEXC7HkdxXksHf9oMvH2HrmjRNkYcDUkqUUtRNw+nfRx7/+JVHojhBRFFAURRkWUae52hdkqRnRg9TbrxH+rf3LFdviErrLrDWdlr7gyimdzdGDEcIMeDp+QVRGUOp1DVs9bLUTLwZ89mC9XbD1/cPIgz9TmwjYwxaa5xzvL9+sP/c0c45ywXG7qUGJ1gw4wAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="640" height="340"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/fig_1.48d8f1a.640.png" srcset="/assets/ideal-img/fig_1.48d8f1a.640.png 640w,/assets/ideal-img/fig_1.981d6a3.1030.png 1030w" width="640" height="340"></noscript></div><p>Workflow automations have predominantly encompassed simple &quot;if-this-then-that&quot; (IFTTT) tasks that supported simple data transfer from one task to another. For example: when a Google form gets submitted, it&#x27;s content is sent as a slack message. These automations are often referred to as Trigger-Action based workflows, where a trigger (such as a new email, slack message, a signup, a form submit) would set off a train of actions (such as parsing a message, adding a row to Google Sheets, sending a notification). Performing simple information transfer have been the crux of these workflows, and have mostly evolved horizontally to integrate with the vast array of SaaS tools ranging from Google Sheets/Docs/Drive, Mailchimp, Slack, Confluence, Jira, Notion etc.</p><p>The latest advances in Large Language Models (LLM) show great potential to enhance our capabilities to build workflows that are beyond simple triggers and actions. As an example, there have been an increasing number of tools that showcase Slack bots performing specific business logic-related tasks, such answering questions based on data stored in data warehouses (sql generation &amp; execution), answering questions based on documents (retrieval and summarisation), and so on.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="putting-rag-into-perspective">Putting RAG into perspective<a href="#putting-rag-into-perspective" class="hash-link" aria-label="Direct link to Putting RAG into perspective" title="Direct link to Putting RAG into perspective">​</a></h3><p>One of the common tasks in automations, as mentioned above, have been to answer questions based on certain documents. Which also happens to be a widely recognized use-case for LLMs. However, LLMs being general completion models require domain specific context when it comes to answering domain specific questions. This is where In-Context Learning (ICL) implemented using Retrieval Augmented Generation (RAG) shines. Okay, that sounds like a mouthful, let me unpack it.</p><p>LLMs can be trained on, and/or fine tuned with a corpus of relevant documents to answer questions on those documents. However, the cost of model training and fine-tuning can be high. Another approach is to use In-Context Learning: adding relevant information about the question into a prompt, then using an LLM to generate an answer. This approach is geared towards prompt engineering, where the prompts must include all relevant information about the question.</p><blockquote><p>But, how do we get relevant information about the question?</p></blockquote><p>There are many algorithms being developed to do this task. Here, we will mainly discuss the &quot;Embedding Search&quot; approach. We first store a document as chunks of text along with their embedding vectors. This step can give us a simple Knowledge Base. Then, we use vector similarity to find chunks of text that are relevant to the question. This will be explained in detail in later sections. With the relevant information, a prompt can be finally designed to answer our question.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modern-vs-traditional-workflow-automations">Modern vs. traditional workflow automations<a href="#modern-vs-traditional-workflow-automations" class="hash-link" aria-label="Direct link to Modern vs. traditional workflow automations" title="Direct link to Modern vs. traditional workflow automations">​</a></h3><p>As can be seen from above, the workflow above has a complicated maze of data ingestion, processing tasks, and finally generation of the answer (result). Contrasting this with traditional workflows of simple if-this-then-that tasks begs us to consider a more programmatic approach where we can make use of state of the art libraries such as LangChain, Llama-index, and access custom APIs.</p><p>To understand better the new evolution of workflow automations, lets dive deep into an example of document based question-answering, by designing the triggers-actions, and implementing RAG. The use case would be to implement a Slack bot to answer a question posted to a channel. The question will be based on a few documents.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ingredients-for-an-rag-based-workflow-automation">Ingredients for an RAG based Workflow Automation<a href="#ingredients-for-an-rag-based-workflow-automation" class="hash-link" aria-label="Direct link to Ingredients for an RAG based Workflow Automation" title="Direct link to Ingredients for an RAG based Workflow Automation">​</a></h2><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaklEQVQImU2OCw4AMQRE3f+0/WnR6mzYbLISIeMN6N6LCHeHmWGMgdYaRCS1iGAoGwDnHKhqwr337EP75sTMMFO4v2BsKqVk/cxrTdBkhopg7421VmaAc87URBXBUNyPDHcORFBrzRf+Pz6acsQb88BMfwAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="640" height="312"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/fig_2.771ced0.640.png" srcset="/assets/ideal-img/fig_2.771ced0.640.png 640w,/assets/ideal-img/fig_2.52a0fc7.1030.png 1030w" width="640" height="312"></noscript></div><p>The three main ingredients, or perhaps the only ingredients you&#x27;d need are:</p><ol><li>A framework to listen to triggers, and execute actions or tasks.</li><li>A framework to implement Retrieval Augmented Generation.</li><li>An LLM to work with.</li></ol><p>Assuming that you&#x27;d be using Python, here are your options.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="trigger-action-framework">Trigger-Action Framework <a href="#trigger-action-framework" class="hash-link" aria-label="Direct link to Trigger-Action Framework " title="Direct link to Trigger-Action Framework ">​</a></h3><p>Since the use case we are implementing is to listen to a Slack channel for a message, and reply an answer to that message in Slack there are two options:</p><ol><li><a href="https://github.com/SlackAPI/bolt-python" target="_blank" rel="noopener noreferrer">bolt-python</a> the official Python SDK from Slack to work with Slack APIs. Using this requires you to setup an App and connect it to your workspace you are an admin of, secure all the scopes needed for the task, setup an event listener endpoint or use a websocket connection provided with the SDK to listen to incoming messages that match your trigger conditions. As this setup is far beyond the scope of what we want to discuss in this post, we will opt for an easier alternative.</li><li><a href="https://github.com/modelstar-labs/querystar" target="_blank" rel="noopener noreferrer">querystar</a> is a Python framework that let&#x27;s you setup integrations and work with popular SaaS tools like Slack and Google Sheets without the fuss of authentication, access control, setting up event listeners using web hooks.</li></ol><p>We will use <a href="https://querystar.io/" target="_blank" rel="noopener noreferrer">QueryStar</a> for the use case we are implementing. Here is a <a href="https://querystar.io/docs/quickstart/token/" target="_blank" rel="noopener noreferrer">quickstart</a> on how to get started with it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rag-framework">RAG framework<a href="#rag-framework" class="hash-link" aria-label="Direct link to RAG framework" title="Direct link to RAG framework">​</a></h3><p>There are quite a few frameworks available to implement this, the most popular ones are:</p><ol><li><p><a href="https://www.langchain.com/" target="_blank" rel="noopener noreferrer">LangChain</a> is a very popular framework in Python to work with LLMs,. It provides APIs to create embeddings, and build knowledge bases. That being said, LangChain is a general framework for prompt engineering to build prompt chains, observe and debug etc. RAG is only one of the many built-in modules.</p></li><li><p><a href="https://github.com/jerryjliu/llama_index" target="_blank" rel="noopener noreferrer">LlamaIndex</a> on the other hand is primarily built as a data framework to work with LLMs. It has out of the box functions to create Knowledge Bases, and implement RAG, and connect to LLMS to implement question-answering workflows.</p></li></ol><p>We will use LlamaIndex for implementing our use case. You can find further documentation on <a href="https://gpt-index.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">LlamaIndex</a> here.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-llm">The LLM<a href="#the-llm" class="hash-link" aria-label="Direct link to The LLM" title="Direct link to The LLM">​</a></h3><p>The final ingredient is the Large Language Model. There are plenty of LLM options available at this point to choose from. They differ in openness and utility for specific purposes.</p><p>We will use OpenAI&#x27;s LLM in implementing our case. Get yourself a token from <a href="https://platform.openai.com/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-recipe">The recipe<a href="#the-recipe" class="hash-link" aria-label="Direct link to The recipe" title="Direct link to The recipe">​</a></h2><p>With all the ingredients in place let&#x27;s get started with the use case.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-build-therag">Step 1: Build the RAG<a href="#step-1-build-therag" class="hash-link" aria-label="Direct link to Step 1: Build the RAG" title="Direct link to Step 1: Build the RAG">​</a></h3><p>The documents we will be asking questions on, are the documentation of the LlamaIndex library. A sample question we could ask is:</p><blockquote><p>Question: In llama-index, what is a knowledge graph?</p></blockquote><p><strong><em>Data Preparation</em></strong></p><p>Let&#x27;s start with downloading/cloning <a href="https://github.com/jerryjliu/llama_index/tree/main/docs" target="_blank" rel="noopener noreferrer">LlamaIndex&#x27;s doc folder</a> to a local folder <code>ask_llamaindex_slack_bot</code>.</p><p>There&#x27;re many types of files in the folder. Some files (like <code>.py</code> or <code>.bat</code>) do not contain too much context. So, we only want to keep <code>.md</code> and <code>.rst</code> files:</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Data cleaning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dir_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./lidocs&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#local folder of LlamaIndex documentations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dirs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">walk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.md&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.rst&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the doc folder is clean, it&#x27;s very convenient to use <code>SimpleDirectoryReader</code> function provided in <code>llama_index</code> to load the entire folder to <code>lidocs</code> object at once.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> llama_index </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SimpleDirectoryReader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SimpleDirectoryReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./lidocs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recursive</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lidocs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>Document Indexing​</em></strong></p><p>Now we&#x27;re ready to build the <code>index</code>: dividing each document into chunks and embedding them. <code>LlamaIndex</code> has a great API for this: <code>VectorStoreIndex.from_documents()</code>. Then we store <code>index</code> in files.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> openai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> llama_index </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> VectorStoreIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openai</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;OPENAI_API_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> VectorStoreIndex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_documents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lidocs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># save index to files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">storage_context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The storage folder automatically appears:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── ask_llamaindex_slack_bot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├── docstore.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├── graph_store.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ ├── index_store.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │ └── vector_store.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All the <code>embedding</code> vectors are saved in <code>vector_store.json</code>. The file size is 33 MB, which contains a mathematical representation of the entire LlamaIndex&#x27;s documentation.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>In this step, we use GPT, a commercial model service by OpenAI.</p><p>Before building the index, make sure you have an OpenAI API key. This step may cost you up to $1 for the tokens used. To avoid the cost, you can skip this step and download <em><a href="https://github.com/modelstar-labs/querystar-demo/tree/main/ask_llamaindex_slack_bot/storage" target="_blank" rel="noopener noreferrer">the <code>storage</code> folder from QueryStar demo repo</a></em>.</p><p><code>VectorStoreIndex.from_documents()</code> call may take 2-5 mins to finish, highly depending on API latency in your region.​</p></div></div><p><strong><em>RAG Function</em></strong></p><p>With the index file in place, we can finally build the <code>RAG</code> function. Again, it&#x27;s simple with <code>LlamaIndex</code>. We just need to load them to the <code>index</code> object, and use the built-in query engine to get <code>response</code>:</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> llama_index </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StorageContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> load_index_from_storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> openai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openai</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;OPENAI_API_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ask_llamaindex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># rebuild storage context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> StorageContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_defaults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">persist_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./storage&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># load index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_index_from_storage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storage_context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query_engine </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_query_engine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> query_engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> response</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will the function we will use to answer questions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-build-thebot">Step 2: Build the Bot<a href="#step-2-build-thebot" class="hash-link" aria-label="Direct link to Step 2: Build the Bot" title="Direct link to Step 2: Build the Bot">​</a></h3><p>Before running any code in this section, please make sure you&#x27;ve already <a href="https://querystar.io/docs/quickstart/token/" target="_blank" rel="noopener noreferrer">gotten a QueryStar token</a>, <a href="https://querystar.io/docs/quickstart/install/" target="_blank" rel="noopener noreferrer">installed the library</a>, and <a href="https://querystar.io/docs/quickstart/coding/" target="_blank" rel="noopener noreferrer">can run the <code>hello world</code> Slackbot</a>. The setup process should only take you less than 10 mins.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>QueryStar helps integrate easily with 3rd party API services which also include Slack authorization. So, we do NOT need a Slack token here.</p></div></div><p>So, the workflow to implement a question-answering bot in Slack are:</p><ol><li>Listen for a new message event in a channel. This means the app would be notified whenever a new message, in our case a question is posted to a Slack channel.</li><li>Get the answer for the question, using RAG implemented in the section above. We will use the function <code>ask_llamaindex()</code> we created above.</li><li>Send the answer as a reply to the question in Slack.</li></ol><p>Since (2) is already implemented above, let&#x27;s see how to implement (1) and (3).</p><p><strong><em>Listen to new messages in Slack</em></strong></p><p><code>querystar</code> provides a convenient function to receive notifications of new messages posted to a channel in Slack. These functions, which you use to listen to events are named triggers in <code>querystar</code>. For a Slack message we would use the <code>querystar.triggers.slack.new_message()</code> function. Here is how you can use it:</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> querystar </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> qs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">triggers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">slack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C05PRRJ0H4N&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     trigger_string</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ask llama&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This script is set to listen to a new Slack message. When a message matches the filter condition (<code>channel_id</code> AND <code>trigger_string</code>), a <code>dict</code> object of the message will return to variable <code>data</code>.</p><p>Here is an example of the return:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;client_msg_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ask llama: ...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;user&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;useid...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;1693582549.746649&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;blocks&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">...</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;team&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;thread_ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;1693536314.270179&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;parent_user_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;C05PRRJ0H4N&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;event_ts&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;1693582549.746649&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;channel_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;group&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>Send reply to the question in Slack​</em></strong></p><p>From the message data we received above, we can extract the question from the <code>text</code> property of the data <code>dict</code>. And using the <code>ask_llamaindex</code> function above we can get an answer:</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">question </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;text&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">answer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ask_llamaindex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, we use <code>actions.slack.add_message()</code> to post the answer back to the same channel.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> querystar </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> qs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># send answer to Slack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">slack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C05PRRJ0H4N&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              message</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Answer is: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">answer</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s put all of these pieces together into a complete workflow in app.py :</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> openai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> llama_index </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StorageContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> load_index_from_storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> querystar </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> qs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openai</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">api_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;OPENAI_API_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ask_llamaindex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># rebuild storage context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> StorageContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_defaults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">persist_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./storage&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># load index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_index_from_storage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">storage_context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query_engine </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_query_engine</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> query_engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Listen for a question in Slack channel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">triggers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">slack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C05PRRJ0H4N&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     trigger_string</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ask llama&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Find the answer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">question </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;text&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">answer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ask_llamaindex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">question</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Send answer to back to Slack channel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">slack</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;C05PRRJ0H4N&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              message</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Answer is: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">answer</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-running-theapppy">Step 3: Running the app.py<a href="#step-3-running-theapppy" class="hash-link" aria-label="Direct link to Step 3: Running the app.py" title="Direct link to Step 3: Running the app.py">​</a></h3><p>Open your terminal, run this command inside the folder <code>ask_llamaindex_slack_bot</code> with your Python environment activated that contains the requirements of <code>querystar</code>, <code>openai</code>, and <code>llama-index</code> installed.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">querystar run app.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Asking a question in the specified Slack channel would result in:</p><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQYlYWOywrCMBBF88FuXAuCD7C7bnwU63eJGzWv4qZFk0hKmsiVBBpw5cDZXGbuHFLOSuyWe9TFKXPc1DisKhTTAovJGtt5BfJWFm5w+DekOVPcrzd0XQdrLYwx0FrDe48QAoIP+IQA4r2GFBycc0gpM0KIlFFKoZQCMU+bwqZp8lLbtj/0fQ/yuAhwxtJVfB1D51wmOw7uBc4ZGGWpOTaOGtF7dP8C9Qv+p+bgOv0AAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="640" height="450"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/fig_3.43b503c.640.png" srcset="/assets/ideal-img/fig_3.43b503c.640.png 640w,/assets/ideal-img/fig_3.5b13f0a.701.png 701w" width="640" height="450"></noscript></div><p><strong><em>Now, you can invite your entire team to join this channel and learn LlamaIndex together!</em></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a href="#conclusions" class="hash-link" aria-label="Direct link to Conclusions" title="Direct link to Conclusions">​</a></h2><p>Tasks that were once limited to specific trained language models are now very easy to integrate and use in workflows thanks to the development of Large Language Models. This has opened up the possibilities to explore more powerful workflow automations. With a programmatic approach you can use many state of the art libraries: for example Llama-Index and LangChain, or even in house libraries. A quick and easy approach to automate these workflows in Python is using <a href="https://querystar.io/" target="_blank" rel="noopener noreferrer">QueryStar</a>. In this article we&#x27;ve seen an end-to-end implementation of a Slack bot, which represents a use case of workflow automation, to answer questions based on a certain set of documents.</p><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVQYlVWMT0iTARxAf0PE2WbTyZbWNjcHn3O6bOpcpR0MKkh2KEGjQkHwz0E8SJAXCUQ6i9jBPEStsSBTE/HSxYuHjqk0XFtIE73Y+sYQdN/ohenFB+/04MnrN2HudfcSejJEx+OBc4aeDnH7QQ9r61+RvpHnyAUHuks+pNyDmFyI0XGqyYVIGW8/LCD9o+OIyc3F6hb09msUXq6jsNJLQUUtels9YrATmf+MDD57gZhrMLkDlLj8GBwNGJyNFFc1Y1GaELOT6OLK2dHixVjdQom7Gb2tASlXEIuCzlqDFFXwai6MDI9N/A+lTj9G+1XMyg2s3ltU+a5zxdeGzuph8uUU8iOW4I6ng4fBRwQsrbyfjRJPxNnY3GR3b4/vsRjb8W1k/9c+95UQnf4u2m13+TK/SlpNsrPzjdTuFqr6k2z2AEklUwRKbxIsa0URL0vvlvlLnnT6N5nMH1Q1jablkMPsIR/nPhGZiRKejpCMJTkhd5wjn89zdHSMpmn8A7Al4b1LQ39FAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="640" height="628"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/fig_4.e1bc67e.640.png" srcset="/assets/ideal-img/fig_4.e1bc67e.640.png 640w,/assets/ideal-img/fig_4.49caf7b.878.png 878w" width="640" height="628"></noscript></div><p>Links to the frameworks used in this article:</p><ul><li>QueryStar: <a href="https://github.com/modelstar-labs/querystar" target="_blank" rel="noopener noreferrer">https://github.com/modelstar-labs/querystar</a></li><li>LlamaIndex: <a href="https://github.com/jerryjliu/llama_index" target="_blank" rel="noopener noreferrer">https://github.com/jerryjliu/llama_index</a></li></ul></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#putting-rag-into-perspective" class="table-of-contents__link toc-highlight">Putting RAG into perspective</a></li><li><a href="#modern-vs-traditional-workflow-automations" class="table-of-contents__link toc-highlight">Modern vs. traditional workflow automations</a></li><li><a href="#ingredients-for-an-rag-based-workflow-automation" class="table-of-contents__link toc-highlight">Ingredients for an RAG based Workflow Automation</a><ul><li><a href="#trigger-action-framework" class="table-of-contents__link toc-highlight">Trigger-Action Framework </a></li><li><a href="#rag-framework" class="table-of-contents__link toc-highlight">RAG framework</a></li><li><a href="#the-llm" class="table-of-contents__link toc-highlight">The LLM</a></li></ul></li><li><a href="#the-recipe" class="table-of-contents__link toc-highlight">The recipe</a><ul><li><a href="#step-1-build-therag" class="table-of-contents__link toc-highlight">Step 1: Build the RAG</a></li><li><a href="#step-2-build-thebot" class="table-of-contents__link toc-highlight">Step 2: Build the Bot</a></li><li><a href="#step-3-running-theapppy" class="table-of-contents__link toc-highlight">Step 3: Running the app.py</a></li></ul></li><li><a href="#conclusions" class="table-of-contents__link toc-highlight">Conclusions</a></li></ul></div></div></div></main></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/llamaindex-doc-bot">Tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/modelstar-labs/querystar" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/knowledge">Knowledge Management</a></li><li class="footer__item"><a class="footer__link-item" href="/rag">Retrieval Augmented Generation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Privacy">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/terms">Terms</a></li><li class="footer__item"><a class="footer__link-item" href="/cookies">Cookie policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 QueryStar</div></div></div></footer></div>
<script src="/assets/js/runtime~main.862ca776.js"></script>
<script src="/assets/js/main.5fa594ec.js"></script>
</body>
</html>